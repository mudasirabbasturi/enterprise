import{r as i,J as D,C as H,j as s,S as O}from"./app-BNvUUmEl.js";import{S as V}from"./index-CaKXPVzR.js";import{D as w}from"./index-Dw-fU_By.js";import{C as N}from"./index-75qltQ9A.js";import{I as Y}from"./index-CRvW1yVg.js";import{S as $}from"./index-zZUuQW8Z.js";import{s as E}from"./index-CqQEq_8Q.js";import"./pickAttrs-B-O1NeT5.js";import"./useVariants-BWWb-x4p.js";import"./useLocale-DhOjA_vR.js";import"./CheckOutlined-UVMpW3zu.js";import"./CloseCircleFilled-12r7ww41.js";import"./CloseOutlined-DZW4jfaN.js";import"./DownOutlined-BiWLPvuA.js";import"./SearchOutlined-CqZ0Ampv.js";import"./BaseInput-DZa833Tk.js";import"./TextArea-BZPq0bZ8.js";import"./EyeOutlined-DiEETj_p.js";import"./context-D9W1Owti.js";import"./ExclamationCircleFilled-BCKDqmzc.js";const ne=i.forwardRef(({project:n,onClose:k,setParentLoading:a},I)=>{var g;const{auth:S}=D().props,T=H(),t=(n.project_team_members||[]).find(e=>{var l;return((l=e.user)==null?void 0:l.id)===S.user.id}),j=[{key:"project_marking",label:"Marking"},{key:"project_excel",label:"Excel Sheet"},{key:"project_pricing",label:"Project Pricing"},{key:"project_quality_assurance",label:"Quality Assurance"}],A=[{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"needs_review",label:"Needs Review"}],p={id:t==null?void 0:t.id,project_id:n==null?void 0:n.id,user_id:S.user.id,steps:(t==null?void 0:t.steps)||[],status:(t==null?void 0:t.status)||"in_progress"},J=((g=t==null?void 0:t.steps)==null?void 0:g.filter(e=>!j.some(l=>l.key===e)).map(e=>({key:e,label:e.replace("custom_","").replace(/_/g," ")})))||[],[y,u]=i.useState(p),[o,h]=i.useState(p.steps),[m,C]=i.useState(J),[r,x]=i.useState(""),[c,b]=i.useState(!1);i.useEffect(()=>{u(e=>({...e,steps:o}))},[o]);const _=(e,l)=>{h(d=>l?[...d,e]:d.filter(f=>f!==e))},F=e=>{u(l=>({...l,status:e}))},R=()=>{const e=`custom_${r.trim().toLowerCase().replace(/\s+/g,"_")}`,l=r.trim();if(!l){E.warning("Please enter a task name");return}if(o.includes(e)||m.some(f=>f.key===e)){E.warning("This task already exists");return}const d={key:e,label:l};C([...m,d]),h([...o,e]),x("")},v=()=>{b(!0),a==null||a(!0),O.put(T("EditJoinProject",{TeamMemberId:t==null?void 0:t.id}),y,{preserveScroll:!0,onSuccess:()=>{u(p),h([]),C([]),x(""),k()},onError:()=>{a==null||a(!1),b(!1)},onFinish:()=>{a==null||a(!1),b(!1)}})};return i.useImperativeHandle(I,()=>({submitForm:v})),s.jsxs("div",{className:"d-flex align-items-center flex-column p-3",children:[s.jsxs("h6",{className:"text-center",children:[t?"Update Your Tasks":"Join Project Team",s.jsx("hr",{className:"mb-0"}),s.jsxs("div",{className:"d-flex align-items-center mb-1 mt-1",children:[s.jsxs("label",{className:"me-1",htmlFor:"status",style:{whiteSpace:"nowrap"},children:["Change Your Status:"," "]}),s.jsx(V,{style:{width:"100%"},value:y.status,onChange:F,options:A,disabled:c})]}),s.jsx("hr",{className:"mt-0"})]}),s.jsx(w,{}),j.map(e=>s.jsx(N,{checked:o.includes(e.key),onChange:l=>_(e.key,l.target.checked),children:e.label},e.key)),m.length>0&&m.map(e=>s.jsx(N,{checked:o.includes(e.key),onChange:l=>_(e.key,l.target.checked),children:e.label},e.key)),s.jsx("div",{className:"mt-3 d-flex",children:s.jsx(Y,{type:"text",value:r,onChange:e=>x(e.target.value),placeholder:"Add custom task...",allowClear:!0,suffix:s.jsx("button",{className:"btn btn-primary btn-sm m-0 border-0",onClick:R,disabled:!r.trim(),children:"Add More!"})})}),s.jsx(w,{}),s.jsxs("div",{className:"d-flex justify-content-center",children:[s.jsx("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:k,disabled:c,children:"Cancel"}),s.jsx("button",{className:`btn btn-sm ${c?"btn-light border":"btn-primary"}`,onClick:v,disabled:c||o.length===0,children:c?s.jsx($,{size:"small",children:"Update Task Wait..."}):"Update Tasks"})]})]})});export{ne as default};

import{C as re,J as se,r as l,j as e,B as u,T as b,S as L}from"./app-BNvUUmEl.js";import{U as D,R as U,a as I,b as w}from"./index-DPvysMlI.js";import{P as ae}from"./index-CMRs0_Xi.js";import{R as $}from"./DeleteOutlined-DGkp8rPa.js";import{s as le}from"./index-CqQEq_8Q.js";import"./pickAttrs-B-O1NeT5.js";import"./EyeOutlined-DiEETj_p.js";import"./context-D9W1Owti.js";import"./CheckOutlined-UVMpW3zu.js";import"./CloseCircleFilled-12r7ww41.js";import"./CloseOutlined-DZW4jfaN.js";import"./useLocale-DhOjA_vR.js";import"./ExclamationCircleFilled-BCKDqmzc.js";const P=n=>{if(!n)return"unknown";const x=n.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(x)?"image":x==="pdf"?"pdf":"other"},ye=({ownerId:n})=>{var C,k;const x=(t,o)=>t==null?void 0:t.some(s=>s.name===o),h=re(),y=h().current(),{props:R}=se(),M=((k=(C=R.auth.user)==null?void 0:C.role)==null?void 0:k.permissions)||[],d=t=>x(M,t),[g,F]=l.useState(null),[B,T]=l.useState(null),[E,O]=l.useState(null),[Y,z]=l.useState(null),[A,H]=l.useState(null),[J,S]=l.useState(0),[V,q]=l.useState([]),[G,K]=l.useState([]),[Q,W]=l.useState([]),[X,Z]=l.useState([]),[c,v]=l.useState([]),[ee,te]=l.useState([]);l.useEffect(()=>{n&&axios.get(h("media.index",{id:n})).then(t=>{var m,p,f,N;const o=(m=t.data.profile)==null?void 0:m.file_path,s=(p=t.data.idCardFront)==null?void 0:p.file_path,r=(f=t.data.idCardBack)==null?void 0:f.file_path,a=(N=t.data.resume)==null?void 0:N.file_path;T(o?`/storage/${o}`:null),O(s?`/storage/${s}`:null),z(r?`/storage/${r}`:null),H(a?`/storage/${a}`:null);const i=t.data.media||[];te(i)}).catch(t=>{console.error(t)})},[n,J]);const _=(t,o,s)=>{const r=new FormData;s.forEach(a=>{r.append("file",a)}),r.append("user_id",n),r.append("category",t),F(t),L.post(h("media.upload"),r,{preserveScroll:!0,onSuccess:()=>{o([]),S(a=>a+1)},onError:()=>o([]),onFinish:()=>{F(null)}})},oe=t=>new Promise(o=>{const s=h("media.destroy",t);L.delete(s,{preserveScroll:!0,onSuccess:()=>{S(r=>r+1),o()},onError:()=>{le.error("Failed to delete department")}})}),j=({title:t,fileUrl:o,defaultImg:s,fileList:r,setFileList:a,category:i})=>{const m=P(o);return e.jsxs("div",{className:`col-12 ${y==="user.profile"?"col-md-4":"col-md-3"} d-flex flex-column justify-content-between mb-1`,children:[e.jsx("figure",{className:"d-flex justify-content-center align-items-center",style:{height:"auto",border:"1px solid #ccc",padding:"6px",maxHeight:"200px",minHeight:"150px",overflow:"hidden"},children:o&&m==="image"?e.jsx("img",{src:o,alt:t,style:i==="profile"?{width:"150px",height:"150px",borderRadius:"50%",objectFit:"contain"}:{width:"100%",objectFit:"contain"}}):o&&m==="pdf"?e.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",children:e.jsx(I,{style:{fontSize:"40px",color:"#d32f2f"}})}):o?e.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",children:e.jsx(w,{style:{fontSize:"40px",color:"#555"}})}):e.jsx("img",{src:s,alt:t,style:{width:"100%"}})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(D,{fileList:r,onRemove:p=>{const f=[...r];f.splice(r.indexOf(p),1),a(f)},beforeUpload:p=>(a([...r,p]),!1),children:e.jsx(b,{title:o?d("Update Media")?"":"You do not have permission to update":d("Upload Media")?"":"You do not have permission to upload",color:"red",placement:"top",children:e.jsx(u,{icon:e.jsx(U,{}),disabled:o?!d("Update Media"):!d("Upload Media"),children:o?i==="profile"?"Update Profile":i==="resume"?"Update CV":i==="id_card_front"?"Update ID Card Front":i==="id_card_back"?"Update ID Card Back":"Upload Again":"Select File"})})}),e.jsx(u,{className:"mt-1",type:"primary",onClick:()=>_(i,a,r),disabled:r.length===0,loading:g===i,children:g===i?"Uploading...":"Start Upload"})]})]})};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"row",children:[j({title:"User Profile",fileUrl:B,defaultImg:"/storage/uploads/media/default/profile.svg",fileList:V,setFileList:q,category:"profile"}),j({title:"ID Card Front",fileUrl:E,defaultImg:"/storage/uploads/media/default/id_card_front.svg",fileList:G,setFileList:K,category:"id_card_front"}),j({title:"ID Card Back",fileUrl:Y,defaultImg:"/storage/uploads/media/default/id_card_back.svg",fileList:Q,setFileList:W,category:"id_card_back"}),j({title:"Resume",fileUrl:A,defaultImg:"/storage/uploads/media/default/cv.svg",fileList:X,setFileList:Z,category:"resume"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("h6",{children:"All & Other"})}),e.jsx("div",{className:`${y==="user.profile"?"col-md-3":"col-md-2"} col-6`,children:e.jsxs("div",{className:"d-flex flex-column",children:[d("Upload Media")?e.jsx(D,{fileList:c,onRemove:t=>{const o=[...c];o.splice(c.indexOf(t),1),v(o)},beforeUpload:t=>(v([...c,t]),!1),children:e.jsx(u,{icon:e.jsx(U,{}),children:"Upload Other"})}):e.jsx(b,{title:"You don't have permission to upload media",color:"red",placement:"top",children:e.jsx(u,{icon:e.jsx(U,{}),children:"Upload Other"})}),e.jsx(u,{className:"mt-1",type:"primary",onClick:()=>_("other",v,c),disabled:c.length===0,loading:g==="other",children:g==="other"?"Uploading...":"Start Upload"})]})})]}),e.jsx("div",{className:"row",children:ee.map((t,o)=>{const s=`/storage/${t.file_path}`,r=P(s),a=t.category;return e.jsx("div",{className:`col-12 ${y==="user.profile"?"col-md-4":"col-md-2"}`,children:e.jsxs("figure",{className:"d-flex justify-content-center align-items-center",style:{border:"1px solid #ccc",position:"relative",marginBottom:"3px",minHeight:"200px"},children:[r==="image"?e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx("img",{src:s,style:{width:"100%"},alt:`media-${o}`}),e.jsx("span",{children:a})]}):r==="pdf"?e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx(I,{style:{fontSize:"40px",color:"#d32f2f"}}),e.jsx("span",{children:a})]}):e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx(w,{style:{fontSize:"40px",color:"#d32f2f"}}),e.jsx("span",{children:a})]}),e.jsx("div",{style:{position:"absolute",top:"0",left:"0"},children:d("Delete Media")?e.jsx(b,{title:`Delete File ${t.category}`,color:"red",placement:"leftTop",children:e.jsx(ae,{title:`Are you sure you want to delete "${t.category}"?`,onConfirm:()=>oe(t.id),okText:"Yes",cancelText:"No",children:e.jsx($,{style:{border:"1px dashed red"},className:"btn btn-sm btn-danger"})})}):e.jsx(b,{title:"You don't have permission to delete",color:"red",placement:"leftTop",children:e.jsx($,{style:{border:"1px dashed red"},className:"btn btn-sm btn-danger"})})})]})},o)})})]})};export{ye as default};

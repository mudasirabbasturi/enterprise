import{C as re,J as se,r as i,j as e,T as b,B as U,S as N}from"./app-BNvUUmEl.js";import{U as D,R as L,a as P,b as w}from"./index-DPvysMlI.js";import{s as h}from"./index-CqQEq_8Q.js";import{P as ae}from"./index-CMRs0_Xi.js";import{R as I}from"./DeleteOutlined-DGkp8rPa.js";import"./pickAttrs-B-O1NeT5.js";import"./EyeOutlined-DiEETj_p.js";import"./context-D9W1Owti.js";import"./CheckOutlined-UVMpW3zu.js";import"./CloseCircleFilled-12r7ww41.js";import"./CloseOutlined-DZW4jfaN.js";import"./useLocale-DhOjA_vR.js";import"./ExclamationCircleFilled-BCKDqmzc.js";const M=c=>{if(!c)return"unknown";const x=c.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(x)?"image":x==="pdf"?"pdf":"other"},be=({ownerId:c})=>{var C,k;const x=(t,o)=>t==null?void 0:t.some(s=>s.name===o),y=re(),{props:R}=se(),$=((k=(C=R.auth.user)==null?void 0:C.role)==null?void 0:k.permissions)||[],n=t=>x($,t),[g,F]=i.useState(null),[B,T]=i.useState(null),[Y,O]=i.useState(null),[E,z]=i.useState(null),[A,H]=i.useState(null),[J,S]=i.useState(0),[V,q]=i.useState([]),[G,K]=i.useState([]),[Q,W]=i.useState([]),[X,Z]=i.useState([]),[p,v]=i.useState([]),[ee,te]=i.useState([]);i.useEffect(()=>{c&&axios.get(y("media.index",{id:c})).then(t=>{var m,d,f,u;const o=(m=t.data.profile)==null?void 0:m.file_path,s=(d=t.data.idCardFront)==null?void 0:d.file_path,r=(f=t.data.idCardBack)==null?void 0:f.file_path,a=(u=t.data.resume)==null?void 0:u.file_path;T(o?`/storage/${o}`:null),O(s?`/storage/${s}`:null),z(r?`/storage/${r}`:null),H(a?`/storage/${a}`:null);const l=t.data.media||[];te(l)}).catch(t=>{console.error(t)})},[c,J]);const _=(t,o,s)=>{if(!n("Upload Media")){h.error("You don't have permission to upload media");return}const r=new FormData;s.forEach(a=>{r.append("file",a)}),r.append("user_id",c),r.append("category",t),F(t),N.post(y("media.upload"),r,{preserveScroll:!0,onSuccess:()=>{o([]),S(a=>a+1)},onError:()=>o([]),onFinish:()=>{F(null)}})},oe=t=>n("Delete Media")?new Promise(o=>{const s=y("media.destroy",t);N.delete(s,{preserveScroll:!0,onSuccess:()=>{S(r=>r+1),o()},onError:()=>{h.error("Failed to delete media")}})}):(h.error("You don't have permission to delete media"),Promise.reject()),j=({title:t,fileUrl:o,defaultImg:s,fileList:r,setFileList:a,category:l})=>{const m=M(o),d=n("Upload Media");return e.jsxs("div",{className:"col-12 col-md-3 d-flex flex-column justify-content-between mb-1",children:[e.jsx("figure",{className:"d-flex justify-content-center align-items-center",style:{height:"auto",border:"1px solid #ccc",padding:"6px",maxHeight:"200px",minHeight:"150px",overflow:"hidden"},children:o&&m==="image"?e.jsx("img",{src:o,alt:t,style:l==="profile"?{width:"150px",height:"150px",borderRadius:"50%",objectFit:"contain"}:{width:"100%",objectFit:"contain"}}):o&&m==="pdf"?e.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",children:e.jsx(P,{style:{fontSize:"40px",color:"#d32f2f"}})}):o?e.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",children:e.jsx(w,{style:{fontSize:"40px",color:"#555"}})}):e.jsx("img",{src:s,alt:t,style:{width:"100%"}})}),e.jsx(b,{title:d?"Upload files":"You don't have permission to upload",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(D,{fileList:r,onRemove:f=>{const u=[...r];u.splice(r.indexOf(f),1),a(u)},beforeUpload:f=>d?(a([...r,f]),!1):(h.error("You don't have permission to upload files"),!1),disabled:!d,children:e.jsx(U,{icon:e.jsx(L,{}),disabled:!d,children:o?l==="profile"?"Update Profile":l==="resume"?"Update CV":l==="id_card_front"?"Update ID Card Front":l==="id_card_back"?"Update ID Card Back":"Upload Again":"Select File"})}),e.jsx(U,{className:"mt-1",type:"primary",onClick:()=>_(l,a,r),disabled:r.length===0||!d,loading:g===l,children:g===l?"Uploading...":"Start Upload"})]})})]})};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"row",children:[j({title:"User Profile",fileUrl:B,defaultImg:"/storage/uploads/media/default/profile.svg",fileList:V,setFileList:q,category:"profile"}),j({title:"ID Card Front",fileUrl:Y,defaultImg:"/storage/uploads/media/default/id_card_front.svg",fileList:G,setFileList:K,category:"id_card_front"}),j({title:"ID Card Back",fileUrl:E,defaultImg:"/storage/uploads/media/default/id_card_back.svg",fileList:Q,setFileList:W,category:"id_card_back"}),j({title:"Resume",fileUrl:A,defaultImg:"/storage/uploads/media/default/cv.svg",fileList:X,setFileList:Z,category:"resume"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("h6",{children:"All & Other"})}),e.jsx("div",{className:"col-md-2 col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(b,{title:n("Upload Media")?"Upload Other Files":"You don't have permission to upload",children:e.jsx(D,{fileList:p,onRemove:t=>{const o=[...p];o.splice(p.indexOf(t),1),v(o)},beforeUpload:t=>n("Upload Media")?(v([...p,t]),!1):(h.error("You don't have permission to upload files"),!1),disabled:!n("Upload Media"),children:e.jsx(U,{icon:e.jsx(L,{}),disabled:!n("Upload Media"),children:"Upload Other"})})}),e.jsx(b,{title:n("Upload Media")?"Upload Other Files":"You don't have permission to upload",children:e.jsx(U,{className:"mt-1",type:"primary",onClick:()=>_("other",v,p),disabled:p.length===0||!n("Upload Media"),loading:g==="other",children:g==="other"?"Uploading...":"Start Upload"})})]})})]}),e.jsx("div",{className:"row",children:ee.map((t,o)=>{const s=`/storage/${t.file_path}`,r=M(s),a=t.category,l=n("Delete Media");return e.jsx("div",{className:"col-md-2 col-6",children:e.jsxs("figure",{className:"d-flex justify-content-center align-items-center",style:{border:"1px solid #ccc",position:"relative",marginBottom:"3px",minHeight:"200px"},children:[r==="image"?e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx("img",{src:s,style:{width:"100%"},alt:`media-${o}`}),e.jsx("span",{children:a})]}):r==="pdf"?e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx(P,{style:{fontSize:"40px",color:"#d32f2f"}}),e.jsx("span",{children:a})]}):e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:"inherit"},children:[e.jsx(w,{style:{fontSize:"40px",color:"#d32f2f"}}),e.jsx("span",{children:a})]}),e.jsx("div",{style:{position:"absolute",top:"0",left:"0"},children:e.jsx(b,{title:l?`Delete File ${t.category}`:"No permission to delete",color:"red",placement:"leftTop",children:l?e.jsx(ae,{title:`Are you sure you want to delete "${t.category}"?`,onConfirm:()=>oe(t.id),okText:"Yes",cancelText:"No",children:e.jsx(I,{style:{border:"1px dashed red",cursor:"pointer"},className:"btn btn-sm btn-danger"})}):e.jsx(I,{style:{border:"1px dashed red",cursor:"not-allowed",opacity:.5},className:"btn btn-sm btn-danger"})})})]})},o)})})]})};export{be as default};
